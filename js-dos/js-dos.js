!function i(s,a,u){function c(t,e){if(!a[t]){if(!s[t]){var o="function"==typeof require&&require;if(!e&&o)return o(t,!0);if(l)return l(t,!0);var n=new Error("Cannot find module '"+t+"'");throw n.code="MODULE_NOT_FOUND",n}var r=a[t]={exports:{}};s[t][0].call(r.exports,function(e){return c(s[t][1][e]||e)},r,r.exports,i,s,a,u)}return a[t].exports}for(var l="function"==typeof require&&require,e=0;e<u.length;e++)c(u[e]);return c}({1:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.Build={version:"6.22-9231d18d57bb8c936e0caa9c05f96c8ec3efbc20",wasmSize:2058263,jsSize:501789}},{}],2:[function(e,t,o){"use strict";var r=function(){function n(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,o){return t&&n(e.prototype,t),o&&n(e,o),e}}();Object.defineProperty(o,"__esModule",{value:!0});var n=function(){function n(e,t){var o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),this.dos=e,this.api=e,this.api.ping=function(e){o.onping(e)},this.onready=t}return r(n,[{key:"width",value:function(){return this.dos.canvas.width}},{key:"height",value:function(){return this.dos.canvas.height}},{key:"screenshot",value:function(){var e=this;return new Promise(function(t){e.api.send("screenshot","",function(e){t(e)})})}},{key:"exit",value:function(){try{this.api.send("exit")}catch(e){return 0}return this.dos.error("Runtime is still alive!"),-1}},{key:"onping",value:function(e){switch(e){case"ready":this.onready(this)}}}]),n}();o.DosCommandInteface=n},{}],3:[function(e,t,o){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=function(){function n(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,o){return t&&n(e.prototype,t),o&&n(e,o),e}}();Object.defineProperty(o,"__esModule",{value:!0});var l=e("./js-dos-build"),f=e("./js-dos-xhr"),i=function(){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.wasmSupported=!1,this.global=window,this.wdosboxPromise=null,this.global.exports={};try{if("object"===("undefined"==typeof WebAssembly?"undefined":n(WebAssembly))&&"function"==typeof WebAssembly.instantiate&&"function"==typeof WebAssembly.compile){var e=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));e instanceof WebAssembly.Module&&(this.wasmSupported=new WebAssembly.Instance(e)instanceof WebAssembly.Instance)}}catch(e){}this.polyfill()}return r(t,[{key:"resolveDosBox",value:function(e,t){var o=this;this.global.exports.WDOSBOX?t.ondosbox(this.global.exports.WDOSBOX,this.global.exports.instantiateWasm):this.wasmSupported?(null===this.wdosboxPromise&&(this.wdosboxPromise=this.compileDosBox(e,t)),this.wdosboxPromise.then(function(e){setTimeout(function(){o.wdosboxPromise=null,t.ondosbox(o.global.exports.WDOSBOX,o.global.exports.instantiateWasm)},1)},function(e){setTimeout(function(){o.wdosboxPromise=null,t.onerror(e)},1)})):t.onerror("WebAssembly is not supported, can't resolve wdosbox")}},{key:"compileDosBox",value:function(s,a){var u=this,c=l.Build.wasmSize+l.Build.jsSize;return new Promise(function(r,i){var e=s.replace(".js",".wasm");new f.Xhr(e,{responseType:"arraybuffer",progress:function(e,t){a.onprogress&&a.onprogress(c,t)},fail:function(e,t,o){i("Can't download wasm, code: "+t+", message: "+o+", url: "+e)},success:function(e){var t=WebAssembly.compile(e),n=function(e){i(e+"")};t.catch(n),t.then(function(o){u.global.exports.instantiateWasm=function(e,t){return WebAssembly.instantiate(o,e).catch(n).then(function(e){t(e,o)})},new f.Xhr(s,{progress:function(e,t){a.onprogress&&a.onprogress(c,l.Build.wasmSize+t)},fail:function(e,t,o){i("Can't download wdosbox.js, code: "+t+", message: "+o+", url: "+e)},success:function(e){eval.call(window,e),r(u.global.exports.WDOSBOX)}})})}})})}},{key:"polyfill",value:function(){Math.imul&&-5===Math.imul(4294967295,5)||(Math.imul=function(e,t){var o=65535&e,n=65535&t;return o*n+((e>>>16)*n+o*(t>>>16)<<16)|0}),Math.imul=Math.imul,Math.fround||(Math.fround=function(e){return e}),Math.fround=Math.fround,Math.clz32||(Math.clz32=function(e){e>>>=0;for(var t=0;t<32;t++)if(e&1<<31-t)return t;return 32}),Math.clz32=Math.clz32,Math.trunc||(Math.trunc=function(e){return e<0?Math.ceil(e):Math.floor(e)}),Math.trunc=Math.trunc}}]),t}();o.Host=new i},{"./js-dos-build":1,"./js-dos-xhr":6}],4:[function(e,t,o){"use strict";var n=function(){function n(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,o){return t&&n(e.prototype,t),o&&n(e,o),e}}();Object.defineProperty(o,"__esModule",{value:!0});var r=e("./js-dos-options"),i=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.ci=null,e.isValid=!1,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r.DosOptions),n(t,[{key:"debug",value:function(e){this.log("[DEBUG] "+e)}},{key:"info",value:function(e){this.log("[INFO] "+e)}},{key:"warn",value:function(e){this.log("[WARN] "+e)}},{key:"error",value:function(e){this.log("[ERROR] "+e)}},{key:"ondosbox",value:function(e,t){this.info("DosBox resolved"),this.instantiateWasm=t,this.instance=new e(this)}},{key:"resolve",value:function(){var o=this;this.wdosboxUrl||(this.wdosboxUrl="wdosbox.js"),this.log||(this.log=function(e){return console.log(e)}),this.onready||(this.onready=function(e){o.info("DosBox is ready"),e([])}),this.onprogress||(this.onprogress=function(e,t){return o.info("Resolving DosBox - "+100*t/e+"%")}),this.canvas?(this.SDL={defaults:{widht:320,height:200,copyOnLock:!1,discardOnLock:!0,opaqueFrontBuffer:!1}},this.isValid=!0):this.onerror("canvas field is required, but not set!")}},{key:"onRuntimeInitialized",value:function(){var t=this;this.onready(function(e){t.callMain(e)})}}]),t}();o.DosModule=i},{"./js-dos-options":5}],5:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0});o.DosOptions=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}},{}],6:[function(e,t,o){"use strict";var n=function(){function n(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,o){return t&&n(e.prototype,t),o&&n(e,o),e}}();Object.defineProperty(o,"__esModule",{value:!0});var r=function(){function i(e,t){var o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),this.resource=e,this.options=t,this.options.method=t.method||"GET",this.bytesReceived=0,this.xhr=new XMLHttpRequest,this.xhr.open(this.options.method,e,!0),"POST"===this.options.method&&this.xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded"),this.xhr.overrideMimeType("text/plain; charset=x-user-defined");var n=void 0;"function"==typeof(n=this.xhr).addEventListener&&n.addEventListener("progress",function(e){if(o.bytesReceived=e.loaded,o.options.progress)return o.options.progress(e.total,e.loaded)});var r=void 0;"function"==typeof(r=this.xhr).addEventListener&&r.addEventListener("error",function(e){if(o.options.fail)return o.options.fail(o.resource,o.xhr.status,"connection problem"),delete o.options.fail}),this.xhr.onreadystatechange=function(){return o.onReadyStateChange()},this.options.responseType&&(this.xhr.responseType=this.options.responseType),this.xhr.send(this.options.data)}return n(i,[{key:"onReadyStateChange",value:function(){if(4===this.xhr.readyState)if(200===this.xhr.status){if(this.options.success)return this.options.success(this.xhr.response)}else if(this.options.fail)return this.options.fail(this.resource,this.xhr.status,"connection problem"),delete this.options.fail}},{key:"arrayBufferToString",value:function(e){for(var t=new Uint16Array(e),o=t.length,n="",r=Math.pow(2,16)-1,i=0;i<o;)o<i+r&&(r=o-i),n+=String.fromCharCode.apply(null,t.subarray(i,i+r)),i+=r;return n}}]),i}();o.Xhr=r},{}],7:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var i=e("./js-dos-ci"),s=e("./js-dos-host"),a=e("./js-dos-module");o.Dos=function(e){return new Promise(function(t,o){var n=new a.DosModule;Object.assign(n,e);var r=n.onerror;n.onerror=function(e){o(e),setTimeout(function(){n.onerror=r?(r(e),r):n.error},1)},n.resolve(),n.isValid&&(new i.DosCommandInteface(n,function(e){t(e)}),s.Host.resolveDosBox(n.wdosboxUrl,n))})}},{"./js-dos-ci":2,"./js-dos-host":3,"./js-dos-module":4}]},{},[7]);
//# sourceMappingURL=js-dos.js.map
